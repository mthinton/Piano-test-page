<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Piano Test Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>
<body>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin non dui quis tortor commodo finibus elementum at neque. 
    Fusce sed finibus neque, quis tincidunt sapien. Integer eleifend, purus quis feugiat maximus, quam enim porttitor tellus,
    eget ullamcorper magna nisl eget risus. Nam sit amet nunc fringilla turpis sagittis interdum. Maecenas ex arcu, vestibulum 
    eget dui sed, volutpat consequat ipsum. Duis in nunc iaculis, condimentum nisl sed, feugiat ligula. Proin consectetur id
    ligula sed congue. Aliquam suscipit dui diam, et varius ligula vestibulum non. Mauris vitae turpis varius, placerat quam non,
    mollis purus. Nullam ornare, massa finibus consectetur varius, eros odio ultrices erat, sollicitudin faucibus ex lorem id sem. 
    Maecenas sit amet consectetur lectus.<br></br>
    
    Integer ac orci suscipit, tristique nisl non, dictum eros. Pellentesque habitant morbi tristique senectus et netus et malesuada
    fames ac turpis egestas. Ut ac consectetur orci. Mauris non nisi dui. Nam accumsan ipsum ac ligula pellentesque venenatis ut vitae
    ligula. Interdum et malesuada fames ac ante ipsum primis in faucibus. Sed nec sapien tellus. Maecenas ex nulla, egestas ac tristique 
    vulputate, luctus vel nisi. Proin vitae dictum metus, finibus eleifend ex. Donec id consequat ligula. Vivamus volutpat felis sit amet
    tincidunt congue. Suspendisse gravida placerat aliquam. Nulla vitae purus ut tellus lobortis placerat eu ac dui. Quisque luctus sem a
    ullamcorper ultrices. Etiam dignissim mollis faucibus.<br></br>

    Maecenas luctus ultrices leo. Suspendisse vitae sapien finibus, mattis nulla eu, fermentum ex. Aenean mi dolor, lobortis at orci a,
    volutpat maximus dolor. Donec sed leo gravida, aliquet tellus eu, aliquet tortor. Praesent at nisi vel mi volutpat rutrum. Duis sollicitudin
    turpis lacus, et aliquet ligula ultrices nec. Fusce finibus, elit id lacinia efficitur, felis orci lacinia metus, ut malesuada leo ex non est.
    Pellentesque consequat pellentesque tellus vel facilisis. Nam pretium leo mollis tellus pulvinar, at volutpat ipsum maximus. Nulla nec tempus ante.
    Quisque magna nibh, varius ac varius ac, dignissim non mauris. Donec pellentesque fringilla turpis eu ornare.<br></br>

    Cras blandit leo efficitur ante blandit laoreet. Donec quis volutpat sem, a dapibus dolor. Interdum et malesuada fames ac ante ipsum primis in faucibus.
    Nulla nec mi mattis, molestie arcu quis, commodo sem. Aenean porta ornare augue vel posuere. Proin tincidunt mi ante, quis rutrum neque egestas quis.
    Aenean sed enim feugiat, rhoncus enim a, blandit sapien. Aenean quis aliquam orci. Duis ac turpis ut arcu tristique tempor efficitur quis dolor.
    Suspendisse potenti. Sed blandit odio felis, sit amet convallis mauris rhoncus in. Sed faucibus mauris non felis rutrum tristique. Suspendisse sed
    leo tincidunt, rhoncus elit vitae, ultrices ligula.<br></br>

    Aliquam erat volutpat. Nam et sapien mollis, tempus magna ac, fringilla orci. Mauris eu orci dictum, tempor libero id, hendrerit enim.
    Fusce non eleifend ex. Pellentesque ligula ex, pharetra eget ante in, sagittis malesuada dolor. Mauris suscipit laoreet odio eu interdum.
    In vitae purus sit amet leo facilisis cursus. Suspendisse consectetur pellentesque magna, elementum congue massa accumsan ac.
    Aliquam ornare ligula vitae turpis fringilla, eget dapibus orci efficitur. Phasellus at magna vel leo vestibulum tristique. Nulla rhoncus,
    tortor at scelerisque facilisis, nibh turpis dignissim metus, nec sagittis mi sapien quis nunc. Vestibulum risus lorem, elementum sed tincidunt id,
    bibendum sit amet quam. Morbi consectetur lectus id nisl porttitor, vel facilisis felis bibendum. Mauris pretium, enim ac posuere aliquet,
    lorem arcu consectetur justo, in posuere ligula tellus sit amet neque. Sed id gravida mauris, vitae scelerisque nisl. Maecenas feugiat massa sed leo pulvinar maximus.

    </p>
    <div>
        
    </div>

    <script>
             //creates the tp global object
    tp = window.tp || [];
    //this allows us to use the PianoId functions
    tp.push(["setUsePianoIdUserProvider", true ]);
    //verifying we are working in sandbox environment
    tp.push(["setSandbox", true]);
    //here is where the action starts, with the init function
    tp.push(["init", function() {
        
        //showing the login screen
        tp.pianoId.show({
            disableSignUp: true,
            screen: 'login',
            //once user logs in we need to determine if they have access to site content
            loggedIn: function(data){
                //rid is provided
                var params = {
                    rid : "RVYAS7T"
                 };

                 //Here we check access. In this case even the has@access.com is not receiving access so I manually instructed that email to receive access as well
                 var callback = function(response) {
                    if (response.access && response.access.granted || data.user.email === 'has@access.com') {
                        //if they have access, no more to see here
                        console.log('user has logged in successfully')
                    }
                     else {
                         //if they do not have access they are re-directed back to login screen
                        alert("Sorry, you do not have access to this content. Please upgrade account and log back in");
                        tp.pianoId.logout();
                        location.reload();
                        }
                    
                  }
                  //this is the api call to check access
                  tp.api.callApi("/access/check", params, callback);   
            },
            //upon successful login, reload the page
            loginSuccess: function(){
                location.reload();
            } 
        })
        //isUserValid return true if user is logged in. There should always be a logout button if user is logged in
        if(tp.pianoId.isUserValid()){
            var button = document.createElement("button");
                    //give it the text of logout
                button.innerHTML = "Logout";
                    //add the pianoId.logout() function upon click
                button.addEventListener("click", function(){
                    tp.pianoId.logout(function(){
                        //refresh the page to return to login screen
                        location.reload();
                    });
                });
                    //append the button to div
                var div = document.getElementsByTagName("div")[0];
                div.appendChild(button);
        }
    }]);

            //pre-requisite javascript for any piano sandbox application
            (function(src){var a=document.createElement("script");
            a.type="text/javascript";a.async=true;a.src=src;
            var b=document.getElementsByTagName("script")[0];
            b.parentNode.insertBefore(a,b)})("https://sandbox.tinypass.com/xbuilder/experience/load?aid=bW69IEsHwA");
            </script>
    </body>
</html>

